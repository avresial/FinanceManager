@using FinanceManager.Domain.Entities.Bonds;

<MudExpansionPanel @bind-Expanded=_expanded>
    <TitleContent>
        <MudGrid>
            <MudItem xs="3">
                <MudText Typo="Typo.caption" Color="Color.Default">Bond</MudText>
                <MudText Typo="Typo.body1">
                    @if (BondDetails is not null)
                    {
                        @BondDetails.Name
                    }
                    else
                    {
                        @("Unknown Bond")
                    }
                </MudText>
            </MudItem>
            <MudItem xs="3">
                <MudText Typo="Typo.caption" Color="Color.Default">Balance</MudText>
                <MudText Typo="Typo.body1">@BondAccountEntry.Value @_currency</MudText>
            </MudItem>
            <MudItem xs="3">
                <MudText Typo="Typo.caption" Color="Color.Default">Change</MudText>
                <MudText Typo="Typo.body1" Color="@(BondAccountEntry.ValueChange > 0 ? Color.Success : Color.Error)">
                    @BondAccountEntry.ValueChange @_currency
                </MudText>
            </MudItem>
            <MudItem xs="3">
                <MudText Typo="Typo.caption" Color="Color.Default">Posting date</MudText>
                <MudText Typo="Typo.body1">@BondAccountEntry.PostingDate.ToString("yyyy-MM-dd")</MudText>
            </MudItem>
        </MudGrid>
    </TitleContent>

    <ChildContent>
        @if (_expanded)
        {
            <MudGrid>
                <MudItem xs="12" Class="mt-4">
                    <MudGrid>
                        <MudItem xs="6">
                            <MudText Typo="Typo.caption" Color="Color.Default">Posting date</MudText>
                            <MudText Typo="Typo.body1">@BondAccountEntry.PostingDate</MudText>
                        </MudItem>

                        @if (BondAccountEntry.Labels is not null && BondAccountEntry.Labels.Any())
                        {
                            <MudItem xs="6">
                                <MudText Typo="Typo.caption" Color="Color.Default">Labels</MudText>
                                <MudStack Row Spacing="1">
                                    @foreach (var item in BondAccountEntry.Labels)
                                    {
                                        <MudChip T="string">@item.Name</MudChip>
                                    }
                                </MudStack>
                            </MudItem>
                        }
                        @if (BondDetails is not null)
                        {
                            <MudItem xs="12">
                                <MudText Typo="Typo.caption" Color="Color.Default">Issuer</MudText>
                                <MudText Typo="Typo.body1">@BondDetails.Issuer</MudText>
                            </MudItem>
                        }
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="6">
                            <MudButton Variant="Variant.Text" OnClick=ShowEditOverlay>Edit</MudButton>
                        </MudItem>
                        <MudItem xs="6">
                            <MudButton Variant="Variant.Text" OnClick=ShowRemoveOverlay Color="Color.Error">Remove
                            </MudButton>
                        </MudItem>
                    </MudGrid>
                </MudItem>
            </MudGrid>
        }
    </ChildContent>
</MudExpansionPanel>

<MudOverlay @bind-Visible=_updateEntryVisibility DarkBackground="true">
    <MudPaper Class="p-5">
        <UpdateBondEntry BondAccount=BondAccount BondAccountEntry="BondAccountEntry" ActionCompleted="HideOverlay" />
    </MudPaper>
</MudOverlay>

<MudOverlay @bind-Visible=_removeEntryVisibility DarkBackground="true">
    <MudPaper Class="p-5">
        <RemoveBondEntry BondAccountName=@BondAccount.Name BondAccountEntry="BondAccountEntry" Cancel="HideOverlay"
            Confirm="Confirm" />
    </MudPaper>
</MudOverlay>