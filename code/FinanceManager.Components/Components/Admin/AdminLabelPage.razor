@page "/Admin/Labels"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Admin")]
@layout AdminLayout

@if (!_isLoading)
{
    <MudStack Spacing="2">

        @foreach (var message in _errors)
        {
            <MudAlert Severity="Severity.Error">@message</MudAlert>
        }
    </MudStack>


    <MudStack Row AlignItems="AlignItems.Center" Spacing="2" Class="mt-2">
        <MudTextField T="string" Value="@_searchText" ValueChanged="OnSearchChanged" Placeholder="Search by name"
                      Immediate="true" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" Clearable="true"
                      Class="flex-grow-1" />
        <MudIconButton Icon="@Icons.Material.Filled.Add" aria-label="add" Href="Admin/AddLabel" Color="Color.Primary" />
    </MudStack>
    @if (_elements.Any())
    {
        <MudTable @ref="@Table" Items="@_elements" RowsPerPage="@_elementsPerPage" Dense Breakpoint="Breakpoint.Md"
                  LoadingProgressColor="Color.Info" Elevation="0" Class="my-3">
            <HeaderContent>
                <MudTh>Label id</MudTh>
                <MudTh>Label name</MudTh>
                <MudTh>Action</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Label id">@context.Id</MudTd>
                <MudTd DataLabel="Label name">@context.Name</MudTd>
                <MudTd DataLabel="Action">
                    <MudMenu Label="Action" Variant="Variant.Text">
                        <MudMenuItem Label="Edit" Href=@($"Admin/EditLabel/{context.Id}") />
                        <MudMenuItem Label="Remove" OnClick="@(() => RemoveLabel(context.Id))" />
                    </MudMenu>
                </MudTd>
            </RowTemplate>
            <PagerContent>
                @if (Table is not null && _pagesCount > 1)
                {
                    <MudPagination SelectedChanged="PageChanged" Count="@_pagesCount" Selected="@SelectedPage" Class="pa-4" />
                }
            </PagerContent>
        </MudTable>
    }
    else
    {
        <MudAlert Severity="Severity.Info" Class="mt-3">
            No labels found.
        </MudAlert>
    }
}