@using FinanceManager.Domain.Services

@inherits LayoutComponentBase
@inject NavigationManager Navigation
@inject ILoginService LoginService

<AuthorizeView>
    <NotAuthorized>
        <RedirectToLogin />
    </NotAuthorized>
    <Authorized>
        <MudLayout>
            <MudAppBar Dense Elevation="0">
                <MudIconButton Icon="@Icons.Material.Filled.Menu" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
            </MudAppBar>

            <MudDrawer @bind-Open="_drawerOpen" Variant="@DrawerVariant.Mini" Elevation="0">
                <NavMenu DrawerIsOpen=_drawerOpen />
                <MudSpacer />
                <MudNavMenu>
                    <MudNavLink Icon="@Icons.Material.Filled.Settings" Href="UserSettings">Settings</MudNavLink>
                    <MudNavLink Icon="@Icons.Material.Filled.Logout" @onclick=LogOut>Log out</MudNavLink>
                </MudNavMenu>
            </MudDrawer>

            <MudMainContent>
                @Body
            </MudMainContent>
        </MudLayout>
    </Authorized>
</AuthorizeView>

@code {

    bool _drawerOpen = true;

    private async Task LogOut()
    {
        await LoginService.Logout();
        Navigation.NavigateTo("login");
    }
    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }
}