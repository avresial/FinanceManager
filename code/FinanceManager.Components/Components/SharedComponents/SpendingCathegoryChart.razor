@using ApexCharts
@using FinanceManager.Domain.Entities
@using FinanceManager.Domain.Entities.FinancialAccounts.Currencies
@using FinanceManager.Domain.Enums

<ApexChart @ref="chart" TItem="CurrencyAccountEntry"
Title="@Title" XAxisType="XAxisType.Datetime" Height="300">

	@foreach (var serie in DataDictionary)
	{
		<ApexPointSeries TItem="CurrencyAccountEntry"
		Items="serie.Value"
		Name="@serie.Key.ToString()"
		XValue="@(e => e.PostingDate)"
		OrderByDescending="@(e => e.X)"
		YAggregate="@(e => e.Sum(e => e.ValueChange))"
		SeriesType="SeriesType.Line" />
	}
</ApexChart>

@code {
	private ApexChart<CurrencyAccountEntry>? chart;

	[Parameter]
	public Dictionary<string, List<CurrencyAccountEntry>> DataDictionary { get; set; } = new Dictionary<string, List<CurrencyAccountEntry>>();

	[Parameter]
	public string Title { get; set; } = string.Empty;

	protected override async Task OnParametersSetAsync()
	{
		if (chart is null) return;
		
		await chart.UpdateSeriesAsync(true);
	}
}